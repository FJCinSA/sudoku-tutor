<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sudoku Tutor</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{--bg:#141210;--sf:#1e1b17;--sf2:#2a2520;--bd:#2e2720;--bt:#5a4d3f;--tx:#e0d5c7;--mu:#8a7b6a;--dm:#6a5d4f;--ac:#d4a050;--ag:#d4a05022;--gv:#b8a998;--ok:#6aad6a;--og:#6aad6a22;--er:#c45c4a;--eg:#c45c4a22;}
body{background:var(--bg);color:var(--tx);font-family:'Segoe UI',sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:14px 12px;overflow-x:hidden;}
h1{font-family:Georgia,serif;font-size:1.7rem;color:var(--ac);letter-spacing:2px;}
.sub{font-size:.62rem;color:var(--mu);letter-spacing:4px;text-transform:uppercase;margin-bottom:12px;}
.dbar{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap;justify-content:center;}
.dbtn{padding:5px 12px;font-size:.72rem;border:1px solid var(--bd);background:var(--sf);color:var(--mu);border-radius:6px;cursor:pointer;font-family:inherit;text-transform:capitalize;}
.dbtn.on{border-color:var(--ac);color:var(--ac);background:var(--ag);}
.info{display:flex;justify-content:space-between;width:100%;max-width:380px;font-size:.75rem;color:var(--mu);font-family:'Courier New',monospace;margin-bottom:4px;padding:0 2px;}
.pbar{width:100%;max-width:380px;height:3px;background:var(--sf2);border-radius:2px;overflow:hidden;margin-bottom:8px;}
.pf{height:100%;background:linear-gradient(90deg,var(--ac),#e8c060);border-radius:2px;transition:width .4s;}
.board{display:grid;grid-template-columns:repeat(9,1fr);border:2.5px solid var(--bt);border-radius:8px;overflow:hidden;width:min(380px,calc(100vw - 28px));aspect-ratio:1;box-shadow:0 8px 32px #0006,0 0 60px #d4a05018;}
.c{display:flex;align-items:center;justify-content:center;font-family:'Courier New',monospace;font-size:clamp(.85rem,3vw,1.2rem);background:var(--sf);cursor:pointer;user-select:none;transition:background .12s;border-right:1px solid var(--bd);border-bottom:1px solid var(--bd);}
.c:nth-child(9n){border-right:none;}.c:nth-child(n+73){border-bottom:none;}
.c[data-c="2"],.c[data-c="5"]{border-right:2.5px solid var(--bt);}
.c[data-r="2"],.c[data-r="5"]{border-bottom:2.5px solid var(--bt);}
.c.gv{color:var(--gv);font-weight:700;}.c.ip{color:var(--tx);}
.c.sl{background:var(--ag);box-shadow:inset 0 0 0 2px var(--ac);z-index:2;}
.c.hl{background:#d4a05009;}.c.sm{background:#d4a05018;}
.c.hc{background:var(--og);box-shadow:inset 0 0 0 2px var(--ok);}
.c.cf{background:var(--eg);box-shadow:inset 0 0 0 2px var(--er);animation:sk .4s;}
.c.er{color:var(--er);}
.c:active:not(.sl){background:var(--sf2);}
.c{position:relative;overflow:hidden;}
.nt{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);position:absolute;inset:0;padding:1px;}
.nt span{font-size:clamp(.32rem,1vw,.48rem);display:flex;align-items:center;justify-content:center;color:#c8b89a;font-weight:600;}
@keyframes sk{0%,100%{transform:translateX(0)}20%{transform:translateX(-2px)}40%{transform:translateX(2px)}60%{transform:translateX(-1px)}80%{transform:translateX(1px)}}
.acts{display:flex;gap:4px;flex-wrap:wrap;justify-content:center;width:100%;max-width:380px;margin-top:8px;}
.ab{padding:6px 10px;font-size:.68rem;border:1px solid var(--bd);background:var(--sf);color:var(--mu);border-radius:6px;cursor:pointer;font-family:inherit;white-space:nowrap;}
.ab.on{border-color:var(--ac);color:var(--ac);background:var(--ag);}
.np{display:grid;grid-template-columns:repeat(9,1fr);gap:3px;width:100%;max-width:380px;margin-top:8px;}
.nb{padding:8px 0;display:flex;flex-direction:column;align-items:center;font-family:'Courier New',monospace;font-size:clamp(.8rem,2.5vw,1rem);font-weight:600;background:var(--sf);border:1px solid var(--bd);border-radius:6px;color:var(--tx);cursor:pointer;min-width:0;}
.nb.dn{opacity:.25;pointer-events:none;}
.nb small{font-size:.4rem;color:var(--dm);margin-top:1px;font-weight:400;}
.pn{width:100%;max-width:380px;background:#1a1714;border:1px solid var(--bd);border-radius:10px;overflow:hidden;margin-top:12px;}
.tbs{display:flex;border-bottom:1px solid var(--bd);}
.tb{flex:1;padding:9px 6px;font-size:.7rem;font-family:inherit;border:none;cursor:pointer;border-bottom:2px solid transparent;background:transparent;color:var(--dm);}
.tb.on{border-bottom-color:var(--ac);background:var(--sf);color:var(--ac);}
.tbd{padding:14px;max-height:360px;overflow-y:auto;}
.mi{font-size:1.1rem;margin-bottom:2px;}
.mt{font-family:Georgia,serif;font-size:.95rem;color:var(--ac);margin:0 0 6px;}
.mb{font-size:.78rem;line-height:1.6;color:var(--mu);white-space:pre-line;}
.hb{padding:7px 14px;font-size:.72rem;border-radius:6px;cursor:pointer;font-family:inherit;display:inline-block;margin-top:4px;margin-right:4px;}
.ha{border:1px solid var(--ac);background:var(--ag);color:var(--ac);}
.hg{border:1px solid var(--ok);background:var(--og);color:var(--ok);}
.tu{margin-top:14px;padding:8px;background:var(--bg);border-radius:6px;border:1px solid var(--bd);}
.tu h4{font-size:.65rem;color:var(--dm);margin-bottom:4px;text-transform:uppercase;letter-spacing:1px;font-weight:400;}
.li{padding:10px;margin-bottom:6px;border:1px solid var(--bd);border-radius:8px;cursor:pointer;}
.li.on{background:var(--sf);border-color:var(--ac);}
.li h4{font-size:.78rem;font-weight:600;color:var(--mu);}
.li.on h4{color:var(--ac);}
.lt{font-size:.7rem;color:var(--ac);background:#d4a05012;padding:5px 8px;border-radius:4px;margin-top:4px;}
.us{margin-top:14px;padding:12px;background:linear-gradient(135deg,#2a1f14,#1a1714);border:1px solid var(--bt);border-radius:8px;text-align:center;}
.us h4{font-size:.8rem;color:var(--ac);font-weight:600;margin-bottom:3px;}
.us p{font-size:.7rem;color:var(--mu);margin:3px 0 8px;line-height:1.4;}
.us button{padding:7px 18px;font-size:.72rem;border:1px solid var(--ac);background:var(--ac);color:var(--bg);border-radius:6px;cursor:pointer;font-weight:600;font-family:inherit;}
details{margin-bottom:6px;background:var(--sf);border:1px solid var(--bd);border-radius:8px;overflow:hidden;}
summary{padding:8px 10px;font-size:.78rem;color:var(--tx);cursor:pointer;display:flex;align-items:center;gap:6px;list-style:none;}
summary::-webkit-details-marker{display:none;}
.tg{font-size:.55rem;padding:2px 6px;border-radius:4px;text-transform:uppercase;}
.td{padding:0 10px 10px;font-size:.75rem;line-height:1.55;color:var(--mu);}
.tx{background:var(--bg);border-radius:6px;padding:6px 8px;margin:4px 0;}
.tx strong{font-size:.62rem;text-transform:uppercase;letter-spacing:1px;}
.mo{position:fixed;inset:0;background:#000a;display:none;align-items:center;justify-content:center;z-index:100;}
.mo.sh{display:flex;}
.mi2{background:var(--sf);border:1px solid var(--bt);border-radius:16px;padding:32px;text-align:center;max-width:340px;margin:16px;}
.mo h2{font-family:Georgia,serif;color:var(--ac);font-size:1.4rem;margin:0 0 6px;}
.mo p{color:var(--mu);font-size:.82rem;line-height:1.5;margin:0 0 14px;}
.mbs{display:flex;gap:8px;justify-content:center;}
.mbs button{padding:9px 20px;font-size:.8rem;border-radius:8px;cursor:pointer;font-family:inherit;}
.bp{border:1px solid var(--ac);background:var(--ac);color:var(--bg);font-weight:600;}
.bs{border:1px solid var(--bd);background:var(--sf);color:var(--mu);}
</style>
</head>
<body>
<h1>Sudoku Tutor</h1>
<div class="sub">Learn ¬∑ Solve ¬∑ Master</div>
<div class="dbar" id="dB"></div>
<div class="info"><span id="xM">‚ùå 0</span><span id="xS">‚ö° 0</span><span id="xK"></span><span id="xT">00:00</span></div>
<div class="pbar"><div class="pf" id="pF" style="width:0%"></div></div>
<div class="board" id="brd"></div>
<div class="acts" id="act"></div>
<div class="np" id="nup"></div>
<div class="pn"><div class="tbs" id="tbs"></div><div class="tbd" id="tbd"></div></div>
<div class="mo" id="wM"><div class="mi2"><div style="font-size:2rem;margin-bottom:6px">üèÜ</div><h2>Puzzle Complete!</h2><p id="wP"></p><div class="mbs"><button class="bp" onclick="go(G.d)">Play Again</button><button class="bs" onclick="nx()">Next ‚Üí</button></div></div></div>
<script>
function sh(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=0|Math.random()*(i+1);[b[i],b[j]]=[b[j],b[i]];}return b;}
function ok(b,r,c,n){for(let i=0;i<9;i++)if(b[r][i]===n||b[i][c]===n)return!1;const R=3*(r/3|0),C=3*(c/3|0);for(let r2=R;r2<R+3;r2++)for(let c2=C;c2<C+3;c2++)if(b[r2][c2]===n)return!1;return!0;}
function fe(b){for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(!b[r][c])return[r,c];return null;}
function fb(b){const e=fe(b);if(!e)return!0;const[r,c]=e;for(const n of sh([1,2,3,4,5,6,7,8,9]))if(ok(b,r,c,n)){b[r][c]=n;if(fb(b))return!0;b[r][c]=0;}return!1;}
function cs(b,mx=2){let ct=0;const d=b.map(r=>[...r]);(function s(){if(ct>=mx)return;const e=fe(d);if(!e){ct++;return;}const[r,c]=e;for(let n=1;n<=9;n++)if(ok(d,r,c,n)){d[r][c]=n;s();if(ct>=mx)return;d[r][c]=0;}})();return ct;}
function gp(df){const b=Array.from({length:9},()=>Array(9).fill(0));fb(b);const s=b.map(r=>[...r]),p=b.map(r=>[...r]),rm={beginner:30,easy:38,medium:46,hard:52,expert:56}[df]||40;let rd=0;for(const[r,c] of sh(Array.from({length:81},(_,i)=>[i/9|0,i%9]))){if(rd>=rm)break;const v=p[r][c];p[r][c]=0;cs(p)===1?rd++:p[r][c]=v;}return{p,s};}
function gc(b,r,c){if(b[r][c])return new Set;const s=new Set([1,2,3,4,5,6,7,8,9]);for(let i=0;i<9;i++){s.delete(b[r][i]);s.delete(b[i][c]);}const R=3*(r/3|0),C=3*(c/3|0);for(let r2=R;r2<R+3;r2++)for(let c2=C;c2<C+3;c2++)s.delete(b[r2][c2]);return s;}
function fns(b){for(let r=0;r<9;r++)for(let c=0;c<9;c++){const d=gc(b,r,c);if(d.size===1){const v=[...d][0];return{t:"Naked Single",r,c,v,e:`R${r+1}C${c+1} can only be ${v}. All others already appear in its row, column, or box.`,l:"Naked Single: only one candidate left = must be the answer."};}}return null;}
function fhs(b){const g=(r,c)=>gc(b,r,c);
for(let r=0;r<9;r++)for(let n=1;n<=9;n++){if([...Array(9)].some((_,c)=>b[r][c]===n))continue;const p=[];for(let c=0;c<9;c++)if(g(r,c).has(n))p.push(c);if(p.length===1)return{t:"Hidden Single (Row)",r,c:p[0],v:n,e:`In row ${r+1}, ${n} can only go in col ${p[0]+1}.`,l:"Hidden Single: only one possible position in this row."};}
for(let c=0;c<9;c++)for(let n=1;n<=9;n++){if([...Array(9)].some((_,r)=>b[r][c]===n))continue;const p=[];for(let r=0;r<9;r++)if(g(r,c).has(n))p.push(r);if(p.length===1)return{t:"Hidden Single (Col)",r:p[0],c,v:n,e:`In col ${c+1}, ${n} can only go in row ${p[0]+1}.`,l:"Scan columns for numbers fitting in only one spot."};}
for(let bR=0;bR<3;bR++)for(let bC=0;bC<3;bC++)for(let n=1;n<=9;n++){let f=0;const p=[];for(let r=bR*3;r<bR*3+3&&!f;r++)for(let c=bC*3;c<bC*3+3;c++){if(b[r][c]===n){f=1;break;}if(!b[r][c]&&g(r,c).has(n))p.push([r,c]);}if(f)continue;if(p.length===1){const[r,c]=p[0];return{t:"Hidden Single (Box)",r,c,v:n,e:`In this box, ${n} can only go at R${r+1}C${c+1}.`,l:"Check boxes for numbers with only one possible cell."};}}
return null;}
function fm(b,s){let m=fns(b);if(m)return m;m=fhs(b);if(m)return m;for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(!b[r][c])return{t:"Elimination",r,c,v:s[r][c],e:`Candidates: ${[...gc(b,r,c)]}. Answer: ${s[r][c]}.`,l:"Advanced patterns needed."};return null;}
function fcf(b,r,c,v){const cl=[];for(let i=0;i<9;i++){if(i!==c&&b[r][i]===v)cl.push([r,i]);if(i!==r&&b[i][c]===v)cl.push([i,c]);}const R=3*(r/3|0),C=3*(c/3|0);for(let r2=R;r2<R+3;r2++)for(let c2=C;c2<C+3;c2++)if(!(r2===r&&c2===c)&&b[r2][c2]===v)cl.push([r2,c2]);return cl;}

const DS=['beginner','easy','medium','hard','expert'];
const G={pz:null,sl:null,bd:null,nt:null,se:null,nm:!1,d:'easy',mk:0,sc:0,ss:0,dn:!1,hi:[],hn:null,cf:[],co:!0,sk:0,tu:{},tb:'tutor',li:0,mg:null,ti:null};
const $=id=>document.getElementById(id);
const ft=s=>String(s/60|0).padStart(2,'0')+':'+String(s%60).padStart(2,'0');

function rAll(){rDf();rIn();rPg();rBd();rAc();rNp();rTb();rTd();}
function sm(i,t,b){G.mg={i,t,b};}
function rDf(){$('dB').innerHTML=DS.map(d=>`<button class="dbtn${G.d===d?' on':''}" onclick="go('${d}')">${d}</button>`).join('');}
function rIn(){$('xM').textContent='‚ùå '+G.mk;$('xS').textContent='‚ö° '+G.sc;$('xK').textContent=G.sk>=3?'üî•'+G.sk:'';$('xT').textContent=ft(G.ss);}
function rPg(){if(!G.pz)return;let f=0,t=0;for(let r=0;r<9;r++)for(let c=0;c<9;c++){if(!G.pz[r][c])t++;if(!G.pz[r][c]&&G.bd[r][c]===G.sl[r][c])f++;}$('pF').style.width=(t?Math.round(f/t*100):100)+'%';}
function rBd(){
  const b=$('brd');b.innerHTML='';const cs2=new Set(G.cf.map(([r,c])=>r+','+c)),hk=G.hn?(G.hn.r+','+G.hn.c):null;
  for(let r=0;r<9;r++)for(let c=0;c<9;c++){
    const v=G.bd[r][c],gv=!!G.pz[r][c],d=document.createElement('div');d.className='c';d.dataset.r=r;d.dataset.c=c;
    const iS=G.se&&G.se[0]===r&&G.se[1]===c,iH=G.se&&(G.se[0]===r||G.se[1]===c||((r/3|0)===(G.se[0]/3|0)&&(c/3|0)===(G.se[1]/3|0))),iM=G.se&&v&&G.bd[G.se[0]][G.se[1]]===v&&!iS,iC=cs2.has(r+','+c),iHn=hk===(r+','+c),iE=!gv&&v&&G.co&&v!==G.sl[r][c];
    if(gv)d.classList.add('gv');else if(v)d.classList.add('ip');
    if(iS)d.classList.add('sl');else if(iHn)d.classList.add('hc');else if(iC)d.classList.add('cf');else if(iM)d.classList.add('sm');else if(iH)d.classList.add('hl');
    if(iE)d.classList.add('er');
    if(v)d.textContent=v;
    else if(G.nt[r][c].size){const nd=document.createElement('div');nd.className='nt';for(let n=1;n<=9;n++){const sp=document.createElement('span');sp.textContent=G.nt[r][c].has(n)?n:'';nd.appendChild(sp);}d.appendChild(nd);}
    d.onclick=()=>sel(r,c);b.appendChild(d);
  }
}
function rAc(){$('act').innerHTML=[
  {l:G.nm?'‚úè ON':'‚úè Notes',o:G.nm,f:'tN()'},{l:'‚úï Erase',o:0,f:'er()'},{l:'‚Ü© Undo',o:0,f:'un()'},
  {l:'üìù Auto',o:0,f:'aN()'},{l:G.co?'‚úì ON':'‚úì Off',o:G.co,f:'tC()'}
].map(a=>`<button class="ab${a.o?' on':''}" onclick="${a.f}">${a.l}</button>`).join('');}
function rNp(){let h='';for(let n=1;n<=9;n++){let ct=0;for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(G.bd[r][c]===n)ct++;h+=`<button class="nb${ct>=9?' dn':''}" onclick="pl(${n})">${n}<small>${ct}/9</small></button>`;}$('nup').innerHTML=h;}
function rTb(){$('tbs').innerHTML=[{id:'tutor',l:'üí° Tutor'},{id:'lessons',l:'üìñ Lessons'},{id:'techniques',l:'üß© Techniques'}].map(t=>`<button class="tb${G.tb===t.id?' on':''}" onclick="G.tb='${t.id}';rTb();rTd()">${t.l}</button>`).join('');}
function rTd(){
  const d=$('tbd');
  if(G.tb==='tutor'){
    let h='';if(G.mg)h+=`<div class="mi">${G.mg.i}</div><h3 class="mt">${G.mg.t}</h3><p class="mb">${G.mg.b}</p>`;
    h+=`<div style="margin-top:12px"><button class="hb ha" onclick="sM()">üí° Show Move</button>`;
    if(G.hn)h+=`<button class="hb hg" onclick="aH()">Place ${G.hn.v}</button>`;h+='</div>';
    if(Object.keys(G.tu).length){h+='<div class="tu"><h4>Techniques Used</h4>';for(const[k,v] of Object.entries(G.tu))h+=`<div style="font-size:.72rem;color:var(--mu)">${k}: <span style="color:var(--ac)">${v}√ó</span></div>`;h+='</div>';}
    d.innerHTML=h;
  } else if(G.tb==='lessons'){
    const ls=[{t:"The Rules",b:"Every row, column, and 3√ó3 box must contain 1‚Äì9 exactly once.",p:"Start with Easy and tap cells."},
    {t:"Scanning",b:"Pick a number that appears often. Scan for where remaining copies must go.",p:"Start with the number nearest 9/9."},
    {t:"Naked Singles",b:"Eliminate 8 candidates ‚Üí the last one is correct. Use Auto Notes.",p:"Auto Notes ‚Üí look for single-candidate cells."},
    {t:"Hidden Singles",b:"If a number can only go in one cell within a unit, it belongs there.",p:"Show Move reveals these."},
    {t:"Notes Mastery",b:"Track candidates. Update as you place numbers.",p:"Toggle Notes mode to pencil in."}];
    let h='<h3 style="font-family:Georgia,serif;font-size:.95rem;color:var(--ac);margin:0 0 10px">Learning Path</h3>';
    ls.forEach((l,i)=>{h+=`<div class="li${G.li===i?' on':''}" onclick="G.li=${i};rTd()"><h4>${i+1}. ${l.t}</h4>`;if(G.li===i)h+=`<p style="font-size:.75rem;line-height:1.55;color:var(--mu);margin:4px 0">${l.b}</p><div class="lt">‚ñ∂ ${l.p}</div>`;h+='</div>';});
    h+='<div class="us"><h4>üîí Advanced Lessons</h4><p>Unlock Naked Pairs, X-Wings, Swordfish and more.</p><button>Upgrade to Pro</button></div>';
    d.innerHTML=h;
  } else {
    const ts=[{n:"Naked Single",df:"Beginner",i:"‚ë†",ds:"Only one candidate left in a cell.",hw:"Check row, col, box. If 8 taken, last is the answer.",ex:"Row has 1-8 ‚Üí cell must be 9."},
    {n:"Hidden Single",df:"Beginner",i:"‚ë°",ds:"A number fits in only one cell in a unit.",hw:"Pick a missing number, scan the unit.",ex:"7 can only go in one cell in the box ‚Üí 7 goes there."},
    {n:"Naked Pair",df:"Intermediate",i:"‚ë¢",ds:"Two cells with same two candidates lock those numbers.",hw:"Find matching pairs, eliminate from other cells.",ex:"{3,7} in two cells ‚Üí remove 3,7 from rest of row."},
    {n:"Pointing Pair",df:"Intermediate",i:"‚ë£",ds:"Candidate restricted to one row in a box ‚Üí eliminate elsewhere.",hw:"If number only in one row within a box, remove from that row in other boxes.",ex:"5 only in row 1 of top-left box ‚Üí remove from row 1 elsewhere."},
    {n:"X-Wing",df:"Advanced",i:"‚ë§",ds:"Candidate in exactly 2 cells in 2 rows, same columns.",hw:"Aligned positions ‚Üí eliminate from those columns.",ex:"4 in cols 2,7 of rows 3 and 8 ‚Üí remove 4 from cols 2,7 elsewhere."}];
    let h='<h3 style="font-family:Georgia,serif;font-size:.95rem;color:var(--ac);margin:0 0 10px">Technique Library</h3>';
    ts.forEach((t,i)=>{const co=t.df==='Beginner'?'var(--ok)':t.df==='Intermediate'?'var(--ac)':'var(--er)',bg=t.df==='Beginner'?'#6aad6a18':t.df==='Intermediate'?'#d4a05018':'#c45c4a18';
    h+=`<details><summary><span>${t.i}</span><span style="flex:1">${t.n}</span><span class="tg" style="color:${co};background:${bg}">${t.df}</span></summary><div class="td"><p style="margin:6px 0;color:var(--gv)">${t.ds}</p><div class="tx" style="border-left:3px solid var(--ac)"><strong style="color:var(--ac)">How to use</strong><p style="margin:3px 0 0">${t.hw}</p></div><div class="tx" style="border-left:3px solid var(--ok)"><strong style="color:var(--ok)">Example</strong><p style="margin:3px 0 0">${t.ex}</p></div>${i>=2?'<div style="margin-top:6px;padding:4px 8px;background:#d4a05012;border-radius:4px;font-size:.65rem;color:var(--ac);text-align:center">üîí Interactive practice in Pro</div>':''}</div></details>`;});
    d.innerHTML=h;
  }
}

function go(df){
  clearInterval(G.ti);G.d=df;const{p,s}=gp(df);G.pz=p;G.sl=s;G.bd=p.map(r=>[...r]);
  G.nt=Array.from({length:9},()=>Array.from({length:9},()=>new Set()));
  G.se=null;G.nm=!1;G.mk=0;G.sc=0;G.ss=0;G.dn=!1;G.hi=[];G.hn=null;G.cf=[];G.tu={};G.sk=0;
  sm('üéØ','Ready',df[0].toUpperCase()+df.slice(1)+' puzzle. Tap a cell or Show Move.');
  G.ti=setInterval(()=>{G.ss++;$('xT').textContent=ft(G.ss);},1000);
  $('wM').classList.remove('sh');rAll();
}
function nx(){const i=Math.min(DS.indexOf(G.d)+1,DS.length-1);go(DS[i]);}
function sel(r,c){
  G.se=[r,c];G.hn=null;G.cf=[];
  if(G.pz[r][c])sm('üìå','Given: '+G.bd[r][c],'Constrains row '+(r+1)+', col '+(c+1)+', and its box.');
  else if(G.bd[r][c]){const o=G.bd[r][c]===G.sl[r][c];sm(o?'‚úÖ':'‚ö†Ô∏è',o?'Correct':'Wrong: '+G.bd[r][c],o?'Correct!':'Not right. Erase and check candidates.');}
  else{const cd=gc(G.bd,r,c);if(!cd.size)sm('üö´','No Candidates','Check for duplicates.');else if(cd.size===1)sm('üí°','Naked Single!','Only '+[...cd][0]+' can go here!');else sm('üîç',cd.size+' Candidates','Possible: '+[...cd].join(', ')+'. Look for Hidden Singles.');}
  rAll();
}
function pl(n){
  if(!G.se||G.dn)return;const[r,c]=G.se;if(G.pz[r][c])return;
  if(G.nm){const nn=G.nt.map(r=>r.map(s=>new Set(s)));nn[r][c].has(n)?nn[r][c].delete(n):nn[r][c].add(n);G.hi.push({t:'n',r,c,p:G.nt[r][c]});G.nt=nn;G.bd[r][c]=0;rAll();return;}
  G.hi.push({t:'p',r,c,v:G.bd[r][c],n:new Set(G.nt[r][c])});G.bd[r][c]=n;G.nt[r][c]=new Set();
  if(n!==G.sl[r][c]){
    G.cf=fcf(G.bd,r,c,n);G.mk++;G.sc=Math.max(0,G.sc-15);G.sk=0;
    G.bd[r][c]=0;const cd=gc(G.bd,r,c);G.bd[r][c]=n;
    const rs=[];G.cf.forEach(([cr,cc])=>{if(cr===r)rs.push('col '+(cc+1));else if(cc===c)rs.push('row '+(cr+1));else rs.push('same box');});
    sm('‚ùå',n+' Cannot Go Here','Conflicts with '+rs.slice(0,2).join(' and ')+'.\n\nPossible: '+[...cd].join(', ')+'.\n\nCheck row, column, and box before placing.');
    rAll();setTimeout(()=>{G.bd[r][c]=0;G.cf=[];rAll();},2000);return;
  }
  for(let i=0;i<9;i++){G.nt[r][i].delete(n);G.nt[i][c].delete(n);}const R=3*(r/3|0),C=3*(c/3|0);for(let r2=R;r2<R+3;r2++)for(let c2=C;c2<C+3;c2++)G.nt[r2][c2].delete(n);
  G.sk++;const bn=G.sk>=5?25:G.sk>=3?15:10;G.sc+=bn;
  let w=!0;for(let r2=0;r2<9;r2++)for(let c2=0;c2<9;c2++)if(G.bd[r2][c2]!==G.sl[r2][c2])w=!1;
  if(w){G.dn=!0;clearInterval(G.ti);$('wP').textContent='Time: '+ft(G.ss)+' ¬∑ Score: '+G.sc+' ¬∑ Mistakes: '+G.mk;$('wM').classList.add('sh');sm('üéâ','Complete!','Solved in '+ft(G.ss)+'!');}
  else{const s=G.sk>=5?' üî•5+ streak!':G.sk>=3?' ‚ö°3+ streak!':'';sm('‚úÖ','Correct!',n+' placed.'+s);}
  rAll();
}
function er(){if(!G.se)return;const[r,c]=G.se;if(G.pz[r][c])return;G.hi.push({t:'e',r,c,v:G.bd[r][c],n:new Set(G.nt[r][c])});G.bd[r][c]=0;G.nt[r][c]=new Set();rAll();}
function un(){if(!G.hi.length)return;const m=G.hi.pop();G.bd[m.r][m.c]=m.v||0;if(m.n)G.nt[m.r][m.c]=m.n;rAll();}
function tN(){G.nm=!G.nm;rAc();}
function tC(){G.co=!G.co;rAll();}
function aN(){for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(!G.bd[r][c])G.nt[r][c]=gc(G.bd,r,c);sm('üìù','Notes Filled','Look for single-candidate cells!');rAll();}
function sM(){const m=fm(G.bd,G.sl);if(!m)return;G.hn=m;G.se=[m.r,m.c];G.tu[m.t]=(G.tu[m.t]||0)+1;sm('üí°',m.t,m.e+'\n\nüìñ '+m.l);rAll();}
function aH(){if(!G.hn)return;const{r,c,v}=G.hn;G.hi.push({t:'p',r,c,v:G.bd[r][c],n:new Set(G.nt[r][c])});G.bd[r][c]=v;G.nt[r][c]=new Set();for(let i=0;i<9;i++){G.nt[r][i].delete(v);G.nt[i][c].delete(v);}const R=3*(r/3|0),C=3*(c/3|0);for(let r2=R;r2<R+3;r2++)for(let c2=C;c2<C+3;c2++)G.nt[r2][c2].delete(v);G.sc+=5;G.hn=null;let w=!0;for(let r2=0;r2<9;r2++)for(let c2=0;c2<9;c2++)if(G.bd[r2][c2]!==G.sl[r2][c2])w=!1;if(w){G.dn=!0;clearInterval(G.ti);$('wP').textContent='Time: '+ft(G.ss)+' ¬∑ Score: '+G.sc+' ¬∑ Mistakes: '+G.mk;$('wM').classList.add('sh');}rAll();}

document.addEventListener('keydown',e=>{
  if(e.key>='1'&&e.key<='9')pl(+e.key);
  else if(e.key==='Backspace'||e.key==='Delete')er();
  else if(e.key==='n')tN();
  else if(e.key==='z'&&(e.ctrlKey||e.metaKey)){e.preventDefault();un();}
  else if(G.se){if(e.key==='ArrowUp')G.se=[Math.max(0,G.se[0]-1),G.se[1]];if(e.key==='ArrowDown')G.se=[Math.min(8,G.se[0]+1),G.se[1]];if(e.key==='ArrowLeft')G.se=[G.se[0],Math.max(0,G.se[1]-1)];if(e.key==='ArrowRight')G.se=[G.se[0],Math.min(8,G.se[1]+1)];rAll();}
});
go('easy');
</script>
</body>
</html>
